# Contributor: Dmitry Pritykin maisvendoo@gmail.com

pkgname=qslave
pkgver=1.0.2
pkgrel=5
pkgdesc="Modbus RTU network emulator for PC"
arch=('x86_64')
url="https://github.com/maisvendoo/qslave"
license=('GPL')
depends=('qt6-base'
		 'qt6-serialport')
makedepends=('git' 'gendesk')

source=("git+https://github.com/fow0ryl/qslave.git#branch=dev")

sha256sums=('SKIP')

build() {
	
	cd $srcdir
	mkdir -p build
	cd build
	qmake6 ../$pkgname
	make
}

prepare() {

	rm -f $srcdir/qslave.desktop
	gendesk -n --pkgname=$pkgname --pkgdesc=$pkgname
}

package() {

	cd $srcdir/$pkgname
	install -Dm644 LICENSE $pkgdir/usr/share/license/$pkgname/LICENSE
	install -Dm644 $srcdir/$pkgname.desktop $pkgdir/usr/share/applications/$pkgname.desktop
	install -Dm644 $pkgname-gui/resources/img/logo.png $pkgdir/usr/share/pixmaps/$pkgname.png

	install -Dm644 cfg/example/example.net $pkgdir/usr/share/qslave/example/example.net
	install -Dm644 cfg/example/traffic-light.xml $pkgdir/usr/share/qslave/example/traffic-light.xml
	install -Dm644 cfg/example/XY-MD02.xml $pkgdir/usr/share/qslave/example/XY-MD02.xml
	
	cd ../bin
	install -Dm755 $pkgname-gui $pkgdir/usr/bin/$pkgname 
}
